---
services:
  gluetun:
    image: {{ docker_images.gluetun }}
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    ports:
      - 8888:8888/tcp # HTTP proxy
    volumes:
      - {{ media_gluetun_base_folder }}:/gluetun
    env_file:
      - {{ media_base_folder }}/gluetun.env
    networks:
      - {{ docker_proxy_network }}
    labels:
      - "traefik.enable=true"
      - "traefik.http.services.client.loadbalancer.server.port=8090"
      - "traefik.http.routers.client.EntryPoints={{ traefik_https_endpoint }}"
      - "traefik.http.routers.client.rule=(Host(`torrent.{{ ansible_domain }}`))"
      - "traefik.http.routers.client.middlewares=lan-whitelist@file, proxyauth@docker"